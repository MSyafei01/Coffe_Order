<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>KopiKu - Pemesanan Online</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      body * {
        visibility: hidden;
      }
      #receipt, #receipt * {
        visibility: visible;
      }
      #receipt {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-yellow-100 min-h-screen flex items-center justify-center p-6">
  <div class="w-full max-w-5xl bg-white rounded-2xl shadow-xl p-8">
    <h1 class="text-3xl font-bold text-center text-amber-800 mb-6">‚òï Pemesanan Kopi Modern</h1>

    <!-- Form -->
    <form id="orderForm" class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <!-- Pilih kopi -->
      <div>
        <label class="block mb-2 font-semibold">Pilih Kopi</label>
        <select id="coffee" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-amber-500">
          <option value="espresso">Espresso</option>
          <option value="latte">Latte</option>
          <option value="cappuccino">Cappuccino</option>
          <option value="americano">Americano</option>
        </select>
      </div>

      <!-- Pilih ukuran -->
      <div>
        <label class="block mb-2 font-semibold">Ukuran</label>
        <select id="size" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-amber-500">
          <option value="small">Small</option>
          <option value="medium">Medium</option>
          <option value="large">Large</option>
        </select>
      </div>

      <!-- Harga realtime -->
      <div>
        <label class="block mb-2 font-semibold">Harga Satuan</label>
        <input type="text" id="unitPrice" readonly class="w-full p-3 border rounded-lg bg-gray-100 text-gray-700 font-semibold">
      </div>

      <!-- Jumlah -->
      <div>
        <label class="block mb-2 font-semibold">Jumlah</label>
        <input type="number" id="quantity" value="1" min="1" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-amber-500">
      </div>

      <!-- Tombol -->
      <div class="md:col-span-4">
        <button type="submit" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 rounded-lg shadow">
          Tambah Pesanan
        </button>
      </div>
    </form>

    <!-- Ringkasan -->
    <div class="mt-8">
      <h2 class="text-2xl font-bold mb-4 text-amber-800">üìã Ringkasan Pesanan</h2>
      <table class="w-full text-left border border-gray-200 rounded-lg overflow-hidden">
        <thead class="bg-amber-100">
          <tr>
            <th class="p-3">Produk</th>
            <th class="p-3">Ukuran</th>
            <th class="p-3">Jumlah</th>
            <th class="p-3">Harga</th>
          </tr>
        </thead>
        <tbody id="orderSummary"></tbody>
      </table>
      <p id="totalPrice" class="mt-4 text-xl font-bold text-amber-900">Total: Rp 0</p>
      <button onclick="printReceipt()" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg shadow">
        üñ®Ô∏è Cetak Struk
      </button>
    </div>
  </div>

  <!-- STRUK CETAK -->
  <div id="receipt" class="hidden p-6 text-gray-800">
    <h2 class="text-center text-2xl font-bold mb-4">KopiKu</h2>
    <p class="text-center mb-2">Jl. Kopi No. 123, Jember</p>
    <hr class="mb-4">
    <table class="w-full text-sm mb-4">
      <thead>
        <tr>
          <th class="text-left">Produk</th>
          <th class="text-left">Ukuran</th>
          <th class="text-right">Jumlah</th>
          <th class="text-right">Subtotal</th>
        </tr>
      </thead>
      <tbody id="receiptBody"></tbody>
    </table>
    <hr class="mb-2">
    <p id="receiptTotal" class="font-bold text-right"></p>
    <p class="text-center mt-6 text-xs">Terima kasih atas kunjungan Anda ‚òï</p>
  </div>

  <!-- Script -->
  <script type="module">
    const coffeePrices = {
      espresso: { small: 15000, medium: 20000, large: 25000 },
      latte: { small: 18000, medium: 23000, large: 28000 },
      cappuccino: { small: 20000, medium: 25000, large: 30000 },
      americano: { small: 12000, medium: 17000, large: 22000 }
    };
    const taxRate = 0.1; 
    const discountThreshold = 5;

    const coffeeEl = document.getElementById('coffee');
    const sizeEl = document.getElementById('size');
    const unitPriceEl = document.getElementById('unitPrice');
    const form = document.getElementById('orderForm');
    const orderSummary = document.getElementById('orderSummary');
    const totalPriceElement = document.getElementById('totalPrice');

    let orders = [];

    function updateUnitPrice() {
      const coffee = coffeeEl.value;
      const size = sizeEl.value;
      const price = coffeePrices[coffee][size];
      unitPriceEl.value = `Rp ${price.toLocaleString()}`;
    }

    function updateSummary() {
      orderSummary.innerHTML = '';
      let subtotal = 0;

      orders.forEach(order => {
        const itemTotal = coffeePrices[order.coffee][order.size] * order.quantity;
        subtotal += itemTotal;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${capitalize(order.coffee)}</td>
          <td class="p-2">${order.size}</td>
          <td class="p-2 text-right">${order.quantity}</td>
          <td class="p-2 text-right">Rp ${itemTotal.toLocaleString()}</td>
        `;
        orderSummary.appendChild(tr);
      });

      let discount = 0;
      const totalItems = orders.reduce((sum, o) => sum + o.quantity, 0);
      if (totalItems > discountThreshold) discount = subtotal * 0.1;

      const tax = (subtotal - discount) * taxRate;
      const total = subtotal - discount + tax;

      totalPriceElement.textContent = `Total: Rp ${total.toLocaleString()}`;
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const coffee = coffeeEl.value;
      const size = sizeEl.value;
      const quantity = parseInt(document.getElementById('quantity').value);

      orders.push({ coffee, size, quantity });
      updateSummary();
      form.reset();
      updateUnitPrice(); // biar harga realtime balik ke default
    });

    coffeeEl.addEventListener('change', updateUnitPrice);
    sizeEl.addEventListener('change', updateUnitPrice);

    updateUnitPrice(); // harga pertama kali muncul

    window.printReceipt = function () {
      const receiptBody = document.getElementById('receiptBody');
      receiptBody.innerHTML = '';
      let subtotal = 0;

      orders.forEach(order => {
        const itemTotal = coffeePrices[order.coffee][order.size] * order.quantity;
        subtotal += itemTotal;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${capitalize(order.coffee)}</td>
          <td>${order.size}</td>
          <td class="text-right">${order.quantity}</td>
          <td class="text-right">Rp ${itemTotal.toLocaleString()}</td>
        `;
        receiptBody.appendChild(tr);
      });

      let discount = 0;
      const totalItems = orders.reduce((sum, o) => sum + o.quantity, 0);
      if (totalItems > discountThreshold) discount = subtotal * 0.1;
      const tax = (subtotal - discount) * taxRate;
      const total = subtotal - discount + tax;

      document.getElementById('receiptTotal').textContent = `Total: Rp ${total.toLocaleString()}`;

      document.getElementById('receipt').classList.remove('hidden');
      window.print();
      document.getElementById('receipt').classList.add('hidden');
    }
  </script>
</body>
</html>
